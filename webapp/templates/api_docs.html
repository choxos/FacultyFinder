{% extends "base.html" %}

{% block title %}API Documentation - FacultyFinder{% endblock %}

{% block extra_css %}
<style>
.api-section {
    margin-bottom: 3rem;
}

.endpoint-card {
    border-left: 4px solid var(--ff-primary);
    background-color: var(--ff-bg-secondary);
    margin-bottom: 1.5rem;
}

.method-badge {
    font-weight: bold;
    font-size: 0.8rem;
    padding: 0.25rem 0.75rem;
    border-radius: 20px;
}

.method-get { background-color: #28a745; color: white; }
.method-post { background-color: #007bff; color: white; }
.method-put { background-color: #ffc107; color: #212529; }
.method-delete { background-color: #dc3545; color: white; }

.code-block {
    background-color: #f8f9fa;
    border: 1px solid #e9ecef;
    border-radius: 0.375rem;
    padding: 1rem;
    margin: 1rem 0;
    font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
    font-size: 0.9rem;
    overflow-x: auto;
}

[data-theme="dark"] .code-block {
    background-color: #2d3748;
    border-color: #4a5568;
    color: #e2e8f0;
}

.parameter-table th {
    background-color: var(--ff-primary);
    color: white;
    border: none;
}

.parameter-table td {
    border-color: var(--ff-border-color);
}

.response-example {
    max-height: 300px;
    overflow-y: auto;
}

.api-key-section {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border-radius: 1rem;
    padding: 2rem;
    margin-bottom: 2rem;
}

.rate-limit-info {
    background-color: #fff3cd;
    border: 1px solid #ffeaa7;
    border-radius: 0.5rem;
    padding: 1rem;
    margin-bottom: 1rem;
}

[data-theme="dark"] .rate-limit-info {
    background-color: #3d3d00;
    border-color: #6b5b00;
    color: #e2e8f0;
}
</style>
{% endblock %}

{% block content %}
<div class="container py-5">
    <!-- Header -->
    <div class="row mb-5">
        <div class="col-12 text-center">
            <h1 class="display-4 fw-bold text-primary mb-3">
                <i class="fas fa-code me-3"></i>
                API Documentation
            </h1>
            <p class="lead text-muted">
                Integrate FacultyFinder data into your applications with our comprehensive REST API
            </p>
        </div>
    </div>

    <!-- API Key Section -->
    <div class="api-key-section text-center">
        <h3 class="mb-3">
            <i class="fas fa-key me-2"></i>
            Get Started with FacultyFinder API
        </h3>
        <p class="mb-4">
            Access our global database of faculty members, universities, and academic information programmatically.
        </p>
        <div class="row justify-content-center">
            <div class="col-md-8">
                <div class="alert alert-info mb-0">
                    <strong>Coming Soon:</strong> API key authentication system is currently under development. 
                    Public endpoints are available for testing. Contact us for early access to premium endpoints.
                </div>
            </div>
        </div>
    </div>

    <!-- Rate Limiting -->
    <div class="rate-limit-info">
        <h5><i class="fas fa-tachometer-alt me-2"></i>Rate Limiting</h5>
        <p class="mb-0">
            <strong>Free Tier:</strong> 100 requests per hour, 1000 requests per day<br>
            <strong>Premium Tier:</strong> 1000 requests per hour, 10000 requests per day
        </p>
    </div>

    <!-- Base URL -->
    <div class="api-section">
        <h2 class="mb-4">Base URL</h2>
        <div class="code-block">
            <strong>Production:</strong> https://api.facultyfinder.io/v1/<br>
            <strong>Development:</strong> http://localhost:8080/api/v1/
        </div>
    </div>

    <!-- Authentication -->
    <div class="api-section">
        <h2 class="mb-4">Authentication</h2>
        <p>Include your API key in the request headers:</p>
        <div class="code-block">
curl -H "Authorization: Bearer YOUR_API_KEY" \
     -H "Content-Type: application/json" \
     https://api.facultyfinder.io/v1/faculties
        </div>
    </div>

    <!-- Faculty Endpoints -->
    <div class="api-section">
        <h2 class="mb-4">Faculty Endpoints</h2>

        <!-- Get All Faculty -->
        <div class="endpoint-card card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <div>
                    <span class="method-badge method-get me-2">GET</span>
                    <strong>/api/v1/faculties</strong>
                </div>
                <small class="text-muted">Get list of faculty members</small>
            </div>
            <div class="card-body">
                <p>Retrieve a paginated list of faculty members with optional filtering.</p>
                
                <h6>Query Parameters</h6>
                <div class="table-responsive">
                    <table class="table table-sm parameter-table">
                        <thead>
                            <tr>
                                <th>Parameter</th>
                                <th>Type</th>
                                <th>Description</th>
                                <th>Example</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><code>search</code></td>
                                <td>string</td>
                                <td>Search by name or research interests</td>
                                <td>machine learning</td>
                            </tr>
                            <tr>
                                <td><code>university</code></td>
                                <td>string</td>
                                <td>Filter by university name</td>
                                <td>McMaster University</td>
                            </tr>
                            <tr>
                                <td><code>department</code></td>
                                <td>string</td>
                                <td>Filter by department</td>
                                <td>Computer Science</td>
                            </tr>
                            <tr>
                                <td><code>country</code></td>
                                <td>string</td>
                                <td>Filter by country</td>
                                <td>Canada</td>
                            </tr>
                            <tr>
                                <td><code>limit</code></td>
                                <td>integer</td>
                                <td>Number of results (max 100)</td>
                                <td>20</td>
                            </tr>
                            <tr>
                                <td><code>offset</code></td>
                                <td>integer</td>
                                <td>Pagination offset</td>
                                <td>0</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <h6>Example Request</h6>
                <div class="code-block">
GET /api/v1/faculties?search=machine%20learning&university=McMaster&limit=10
                </div>

                <h6>Example Response</h6>
                <div class="code-block response-example">
{
  "success": true,
  "data": [
    {
      "id": 1,
      "name": "Dr. John Smith",
      "title": "Professor",
      "department": "Computer Science",
      "university": "McMaster University",
      "university_id": 1,
      "email": "smithj@mcmaster.ca",
      "research_areas": ["Machine Learning", "Artificial Intelligence"],
      "publication_count": 45,
      "h_index": 12,
      "total_citations": 890,
      "profile_url": "/professor/1"
    }
  ],
  "pagination": {
    "total": 156,
    "page": 1,
    "per_page": 10,
    "pages": 16,
    "has_next": true,
    "has_prev": false
  }
}
                </div>
            </div>
        </div>

        <!-- Get Single Faculty -->
        <div class="endpoint-card card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <div>
                    <span class="method-badge method-get me-2">GET</span>
                    <strong>/api/v1/faculties/{id}</strong>
                </div>
                <small class="text-muted">Get detailed faculty information</small>
            </div>
            <div class="card-body">
                <p>Retrieve detailed information about a specific faculty member.</p>
                
                <h6>Path Parameters</h6>
                <div class="table-responsive">
                    <table class="table table-sm parameter-table">
                        <thead>
                            <tr>
                                <th>Parameter</th>
                                <th>Type</th>
                                <th>Description</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><code>id</code></td>
                                <td>integer</td>
                                <td>Faculty member ID</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <h6>Example Request</h6>
                <div class="code-block">
GET /api/v1/faculties/1
                </div>

                <h6>Example Response</h6>
                <div class="code-block response-example">
{
  "success": true,
  "data": {
    "id": 1,
    "name": "Dr. John Smith",
    "title": "Professor",
    "department": "Computer Science",
    "university": "McMaster University",
    "university_id": 1,
    "email": "smithj@mcmaster.ca",
    "phone": "+1-905-525-9140",
    "office": "ITB 201",
    "website": "https://johnsmiths.ca",
    "research_areas": ["Machine Learning", "Artificial Intelligence"],
    "degrees": [
      {
        "degree_type": "PhD",
        "field": "Computer Science",
        "university": "University of Toronto",
        "year": 2010
      }
    ],
    "publications": {
      "total": 45,
      "recent": [
        {
          "title": "Deep Learning Approaches to...",
          "year": 2023,
          "journal": "Nature Machine Intelligence",
          "citations": 23
        }
      ]
    },
    "metrics": {
      "h_index": 12,
      "i10_index": 8,
      "total_citations": 890,
      "avg_citations": 19.8
    }
  }
}
                </div>
            </div>
        </div>
    </div>

    <!-- University Endpoints -->
    <div class="api-section">
        <h2 class="mb-4">University Endpoints</h2>

        <!-- Get All Universities -->
        <div class="endpoint-card card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <div>
                    <span class="method-badge method-get me-2">GET</span>
                    <strong>/api/v1/universities</strong>
                </div>
                <small class="text-muted">Get list of universities</small>
            </div>
            <div class="card-body">
                <p>Retrieve a list of universities with faculty and department counts.</p>
                
                <h6>Query Parameters</h6>
                <div class="table-responsive">
                    <table class="table table-sm parameter-table">
                        <thead>
                            <tr>
                                <th>Parameter</th>
                                <th>Type</th>
                                <th>Description</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><code>country</code></td>
                                <td>string</td>
                                <td>Filter by country</td>
                            </tr>
                            <tr>
                                <td><code>type</code></td>
                                <td>string</td>
                                <td>Filter by university type (Public/Private)</td>
                            </tr>
                            <tr>
                                <td><code>language</code></td>
                                <td>string</td>
                                <td>Filter by language of instruction</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <h6>Example Response</h6>
                <div class="code-block response-example">
{
  "success": true,
  "data": [
    {
      "id": 1,
      "name": "McMaster University",
      "city": "Hamilton",
      "province_state": "Ontario",
      "country": "Canada",
      "university_type": "Public",
      "languages": ["English"],
      "year_established": 1887,
      "faculty_count": 281,
      "department_count": 45,
      "website": "https://www.mcmaster.ca"
    }
  ]
}
                </div>
            </div>
        </div>
    </div>

    <!-- Search Endpoints -->
    <div class="api-section">
        <h2 class="mb-4">Search Endpoints</h2>

        <!-- Global Search -->
        <div class="endpoint-card card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <div>
                    <span class="method-badge method-get me-2">GET</span>
                    <strong>/api/v1/search</strong>
                </div>
                <small class="text-muted">Global search across all entities</small>
            </div>
            <div class="card-body">
                <p>Search across faculty, universities, and research areas simultaneously.</p>
                
                <h6>Query Parameters</h6>
                <div class="table-responsive">
                    <table class="table table-sm parameter-table">
                        <thead>
                            <tr>
                                <th>Parameter</th>
                                <th>Type</th>
                                <th>Description</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><code>q</code></td>
                                <td>string</td>
                                <td>Search query (required)</td>
                            </tr>
                            <tr>
                                <td><code>type</code></td>
                                <td>string</td>
                                <td>Filter by type: faculty, universities, all</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <h6>Example Response</h6>
                <div class="code-block response-example">
{
  "success": true,
  "data": {
    "faculty": [
      {
        "id": 1,
        "name": "Dr. John Smith",
        "relevance_score": 0.95,
        "match_type": "research_area"
      }
    ],
    "universities": [
      {
        "id": 1,
        "name": "McMaster University",
        "relevance_score": 0.78,
        "match_type": "department"
      }
    ]
  }
}
                </div>
            </div>
        </div>
    </div>

    <!-- Statistics Endpoints -->
    <div class="api-section">
        <h2 class="mb-4">Statistics Endpoints</h2>

        <!-- Platform Stats -->
        <div class="endpoint-card card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <div>
                    <span class="method-badge method-get me-2">GET</span>
                    <strong>/api/v1/stats</strong>
                </div>
                <small class="text-muted">Get platform statistics</small>
            </div>
            <div class="card-body">
                <p>Retrieve overall platform statistics and metrics.</p>

                <h6>Example Response</h6>
                <div class="code-block response-example">
{
  "success": true,
  "data": {
    "total_professors": 2456,
    "total_universities": 145,
    "total_publications": 45789,
    "countries_covered": 23,
    "top_research_areas": [
      "Machine Learning",
      "Biomedical Engineering",
      "Climate Science"
    ]
  }
}
                </div>
            </div>
        </div>
    </div>

    <!-- Error Responses -->
    <div class="api-section">
        <h2 class="mb-4">Error Responses</h2>
        <p>All endpoints return consistent error responses with appropriate HTTP status codes.</p>
        
        <div class="table-responsive">
            <table class="table parameter-table">
                <thead>
                    <tr>
                        <th>Status Code</th>
                        <th>Description</th>
                        <th>Example Response</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>400</td>
                        <td>Bad Request</td>
                        <td><code>{"success": false, "error": "Invalid parameters"}</code></td>
                    </tr>
                    <tr>
                        <td>401</td>
                        <td>Unauthorized</td>
                        <td><code>{"success": false, "error": "Invalid API key"}</code></td>
                    </tr>
                    <tr>
                        <td>404</td>
                        <td>Not Found</td>
                        <td><code>{"success": false, "error": "Resource not found"}</code></td>
                    </tr>
                    <tr>
                        <td>429</td>
                        <td>Rate Limited</td>
                        <td><code>{"success": false, "error": "Rate limit exceeded"}</code></td>
                    </tr>
                    <tr>
                        <td>500</td>
                        <td>Server Error</td>
                        <td><code>{"success": false, "error": "Internal server error"}</code></td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- SDKs and Libraries -->
    <div class="api-section">
        <h2 class="mb-4">SDKs and Code Examples</h2>
        
        <div class="row">
            <div class="col-md-6">
                <h5>Python</h5>
                <div class="code-block">
import requests

api_key = "your_api_key_here"
headers = {"Authorization": f"Bearer {api_key}"}

# Search faculty
response = requests.get(
    "https://api.facultyfinder.io/v1/faculties",
    headers=headers,
    params={"search": "machine learning", "limit": 10}
)

faculty = response.json()
print(f"Found {len(faculty['data'])} faculty members")
                </div>
            </div>
            
            <div class="col-md-6">
                <h5>JavaScript</h5>
                <div class="code-block">
const apiKey = 'your_api_key_here';

async function searchFaculty(query) {
    const response = await fetch(
        `https://api.facultyfinder.io/v1/faculties?search=${query}`,
        {
            headers: {
                'Authorization': `Bearer ${apiKey}`,
                'Content-Type': 'application/json'
            }
        }
    );
    
    const data = await response.json();
    return data.data;
}

// Usage
searchFaculty('artificial intelligence')
    .then(faculty => console.log(faculty));
                </div>
            </div>
        </div>
    </div>

    <!-- Support -->
    <div class="api-section">
        <h2 class="mb-4">Support & Contact</h2>
        <div class="row">
            <div class="col-md-4">
                <div class="card h-100">
                    <div class="card-body text-center">
                        <i class="fas fa-book fa-2x text-primary mb-3"></i>
                        <h5>Documentation</h5>
                        <p class="text-muted">Detailed guides and tutorials</p>
                        <a href="/contact" class="btn btn-outline-primary">View Docs</a>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card h-100">
                    <div class="card-body text-center">
                        <i class="fas fa-comments fa-2x text-success mb-3"></i>
                        <h5>Community</h5>
                        <p class="text-muted">Join our developer community</p>
                        <a href="/contact" class="btn btn-outline-success">Join Community</a>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card h-100">
                    <div class="card-body text-center">
                        <i class="fas fa-envelope fa-2x text-warning mb-3"></i>
                        <h5>Support</h5>
                        <p class="text-muted">Get help with integration</p>
                        <a href="/contact" class="btn btn-outline-warning">Contact Support</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Add copy functionality to code blocks
    const codeBlocks = document.querySelectorAll('.code-block');
    
    codeBlocks.forEach(block => {
        // Create copy button
        const copyBtn = document.createElement('button');
        copyBtn.innerHTML = '<i class="fas fa-copy"></i>';
        copyBtn.className = 'btn btn-sm btn-outline-secondary position-absolute';
        copyBtn.style.top = '0.5rem';
        copyBtn.style.right = '0.5rem';
        copyBtn.title = 'Copy to clipboard';
        
        // Make block relative positioned
        block.style.position = 'relative';
        block.appendChild(copyBtn);
        
        // Add copy functionality
        copyBtn.addEventListener('click', async () => {
            try {
                await navigator.clipboard.writeText(block.textContent.replace('', ''));
                copyBtn.innerHTML = '<i class="fas fa-check"></i>';
                copyBtn.className = 'btn btn-sm btn-success position-absolute';
                
                setTimeout(() => {
                    copyBtn.innerHTML = '<i class="fas fa-copy"></i>';
                    copyBtn.className = 'btn btn-sm btn-outline-secondary position-absolute';
                }, 2000);
            } catch (err) {
                console.error('Failed to copy text: ', err);
            }
        });
    });
    
    // Smooth scrolling for anchor links
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
            e.preventDefault();
            const target = document.querySelector(this.getAttribute('href'));
            if (target) {
                target.scrollIntoView({
                    behavior: 'smooth',
                    block: 'start'
                });
            }
        });
    });
    
    // Highlight current section in navigation
    const sections = document.querySelectorAll('.api-section');
    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                // Could add navigation highlighting here
            }
        });
    }, { threshold: 0.3 });
    
    sections.forEach(section => observer.observe(section));
});
</script>
{% endblock %} 