<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Faculty Search - FacultyFinder</title>
    
    <!-- Meta Tags -->
    <meta name="description" content="Search and discover faculty members worldwide. Filter by research areas, departments, universities, and more.">
    <meta name="keywords" content="faculty search, professors, researchers, academic staff, universities, research areas">
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@6.0.0/css/all.min.css">
    
    <!-- Custom CSS Theme -->
    <link rel="stylesheet" href="/static/css/themes/facultyfinder-theme.css">
    <link rel="stylesheet" href="/static/css/facultyfinder.css">
    <link rel="stylesheet" href="/static/css/filter-fixes.css">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-light fixed-top bg-white shadow-sm">
        <div class="container">
            <a class="navbar-brand fw-bold text-primary" href="/">
                <i class="fas fa-graduation-cap me-2"></i>
                FacultyFinder
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="/countries">Countries</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/universities">Universities</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="/faculties">Faculties</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/ai-assistant">
                            <i class="fas fa-robot me-1"></i>AI Assistant
                        </a>
                    </li>
                </ul>
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="btn btn-primary" href="/api/docs">
                            <i class="fas fa-code me-1"></i>API Docs
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container">
        <!-- Page Header -->
        <div class="row mb-4">
            <div class="col-12">
                <h1 class="mb-3">
                    <i class="fas fa-users text-primary me-3"></i>
                    Faculty Search
                </h1>
                <p class="lead text-muted">
                    Discover faculty members from universities worldwide. Search by name, research interests, or filter by university and department.
                </p>
            </div>
        </div>
        
        <!-- Search and Filters -->
        <div class="search-filters">
            <form id="faculty-search-form">
                <div class="row">
                    <div class="col-lg-3 col-md-6 mb-3">
                        <label class="filter-label">Country</label>
                        <select class="form-select" name="country" id="countrySelect">
                            <option value="">All Countries</option>
                        </select>
                    </div>
                    <div class="col-lg-3 col-md-6 mb-3">
                        <label class="filter-label">University</label>
                        <select class="form-select" name="university" id="universitySelect">
                            <option value="">All Universities</option>
                        </select>
                    </div>
                    <div class="col-lg-3 col-md-6 mb-3">
                        <label class="filter-label">Department</label>
                        <select class="form-select" name="department" id="departmentSelect">
                            <option value="">All Departments</option>
                        </select>
                    </div>
                    <div class="col-lg-3 col-md-6 mb-3">
                        <label class="filter-label">Search</label>
                        <input type="text" class="form-control" name="search" id="searchInput"
                               placeholder="Search faculty...">
                    </div>
                </div>
                <div class="row">
                    <div class="col-lg-3 mb-3">
                        <label class="filter-label">Research Area</label>
                        <input type="text" class="form-control" name="research_area" id="researchAreaInput"
                               placeholder="Research interests...">
                    </div>
                    <div class="col-lg-3 mb-3">
                        <label class="filter-label">Academic Rank</label>
                        <select class="form-select" name="position" id="positionSelect">
                            <option value="">All Ranks</option>
                            <option value="Professor">Professor</option>
                            <option value="Associate Professor">Associate Professor</option>
                            <option value="Assistant Professor">Assistant Professor</option>
                            <option value="Lecturer">Lecturer</option>
                            <option value="Senior Lecturer">Senior Lecturer</option>
                            <option value="Reader">Reader</option>
                        </select>
                    </div>
                    <div class="col-lg-2 col-md-3 mb-3">
                        <label class="filter-label">Employment Type</label>
                        <select class="form-select" name="employment_type" id="employmentTypeSelect">
                            <option value="">All Types</option>
                            <option value="full_time">Full-time</option>
                            <option value="part_time">Part-time</option>
                            <option value="adjunct">Adjunct</option>
                        </select>
                    </div>
                    <div class="col-lg-4 col-md-6 mb-3">
                        <label class="filter-label">Sort By</label>
                        <select class="form-select" name="sort_by" id="sortBySelect">
                            <option value="name">Name</option>
                            <option value="university">University</option>
                            <option value="department">Department</option>
                            <option value="publications">Publications</option>
                            <option value="recent_publications">Recent Publications</option>
                        </select>
                    </div>
                </div>
                <div class="row">
                    <div class="col-lg-3 mb-3 d-flex align-items-end">
                        <button type="submit" class="btn btn-primary me-2">
                            <i class="fas fa-search me-2"></i>Search
                        </button>
                        <button type="button" class="btn btn-outline-secondary" onclick="clearFilters()">
                            <i class="fas fa-times me-2"></i>Clear
                        </button>
                    </div>
                </div>
            </form>
        </div>
        
        <!-- Results Header -->
        <div class="row">
            <div class="col-12">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h3 id="results-info">Loading faculty members...</h3>
                    <div class="view-controls d-flex align-items-center">
                        <div class="btn-group me-3" role="group">
                            <button type="button" class="btn btn-outline-primary btn-sm active" data-view="grid" onclick="toggleView('grid')">
                                <i class="fas fa-th"></i>
                            </button>
                            <button type="button" class="btn btn-outline-primary btn-sm" data-view="list" onclick="toggleView('list')">
                                <i class="fas fa-list"></i>
                            </button>
                        </div>
                        
                        <div class="d-flex align-items-center">
                            <label class="small text-muted me-2">Per page:</label>
                            <select class="form-select form-select-sm" style="width: auto;" id="perPageSelect" onchange="searchFaculty()">
                                <option value="12">12</option>
                                <option value="24" selected>24</option>
                                <option value="48">48</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <!-- Faculty Grid -->
                <div id="faculty-grid" class="row">
                    <!-- Loading indicator -->
                    <div class="col-12 text-center p-5">
                        <div class="loading-spinner"></div>
                        <p class="mt-3 text-muted">Loading faculty members...</p>
                    </div>
                </div>
                
                <!-- Faculty Table (Hidden by default) -->
                <div id="faculty-table" class="table-responsive" style="display: none;">
                    <table class="table table-hover table-striped">
                        <thead class="table-dark">
                            <tr>
                                <th scope="col">Name</th>
                                <th scope="col">Position</th>
                                <th scope="col">University</th>
                                <th scope="col">Department</th>
                                <th scope="col">Research Areas</th>
                                <th scope="col" class="text-center">Publications</th>
                                <th scope="col">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="faculty-table-body">
                        </tbody>
                    </table>
                </div>
                
                <!-- Pagination -->
                <div id="pagination-container" class="d-flex justify-content-center mt-4"></div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Custom JavaScript -->
    <script>
        // Global variables
        let currentView = 'grid';
        let currentPage = 1;
        let currentFilters = {
            search: '',
            country: '',
            university: '',
            department: '',
            research_area: '',
            employment_type: '',
            sort_by: 'name'
        };
        let allFaculty = [];
        let countries = [];
        let universities = [];
        let departments = [];
        
        // API Base URL
        const API_BASE = '/api/v1';
        
        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            loadCountries();
            loadUniversities();
            loadFaculty();
            
            // Add event listeners
            document.getElementById('faculty-search-form').addEventListener('submit', function(e) {
                e.preventDefault();
                searchFaculty();
            });
            
            // Add change listeners for dynamic filtering
            document.getElementById('countrySelect').addEventListener('change', updateUniversities);
            document.getElementById('universitySelect').addEventListener('change', updateDepartments);
        });
        
        // Load countries for filter
        async function loadCountries() {
            try {
                const response = await fetch(`${API_BASE}/countries`);
                const data = await response.json();
                
                const countrySelect = document.getElementById('countrySelect');
                data.forEach(country => {
                    const option = document.createElement('option');
                    option.value = country.country;
                    option.textContent = `${country.country} (${country.faculty_count})`;
                    countrySelect.appendChild(option);
                });
                
            } catch (error) {
                console.error('Error loading countries:', error);
            }
        }
        
        // Load universities for filter
        async function loadUniversities() {
            try {
                const response = await fetch(`${API_BASE}/universities?per_page=100`);
                const data = await response.json();
                
                universities = data.universities;
                updateUniversityOptions();
                
            } catch (error) {
                console.error('Error loading universities:', error);
            }
        }
        
        // Update university options based on selected country
        function updateUniversities() {
            updateUniversityOptions();
            updateDepartments(); // Reset departments when university changes
        }
        
        // Update university select options
        function updateUniversityOptions() {
            const countrySelect = document.getElementById('countrySelect');
            const universitySelect = document.getElementById('universitySelect');
            const selectedCountry = countrySelect.value;
            
            // Clear current options
            universitySelect.innerHTML = '<option value="">All Universities</option>';
            
            // Filter universities by selected country
            const filteredUniversities = selectedCountry 
                ? universities.filter(uni => uni.country === selectedCountry)
                : universities;
            
            filteredUniversities.forEach(university => {
                const option = document.createElement('option');
                option.value = university.university_code;
                option.textContent = `${university.name} (${university.faculty_count})`;
                universitySelect.appendChild(option);
            });
        }
        
        // Update departments (placeholder - would need API endpoint)
        function updateDepartments() {
            const departmentSelect = document.getElementById('departmentSelect');
            departmentSelect.innerHTML = '<option value="">All Departments</option>';
            
            // This would typically load departments based on selected university
            // For now, we'll add some common departments
            const commonDepartments = [
                'Computer Science', 'Medicine', 'Engineering', 'Biology', 
                'Chemistry', 'Physics', 'Mathematics', 'Psychology', 
                'Business', 'Economics', 'History', 'Literature'
            ];
            
            commonDepartments.forEach(dept => {
                const option = document.createElement('option');
                option.value = dept;
                option.textContent = dept;
                departmentSelect.appendChild(option);
            });
        }
        
        // Search faculty
        function searchFaculty() {
            // Get filter values
            currentFilters.search = document.getElementById('searchInput').value;
            currentFilters.country = document.getElementById('countrySelect').value;
            currentFilters.university = document.getElementById('universitySelect').value;
            currentFilters.department = document.getElementById('departmentSelect').value;
            currentFilters.research_area = document.getElementById('researchAreaInput').value;
            currentFilters.employment_type = document.getElementById('employmentTypeSelect').value;
            currentFilters.sort_by = document.getElementById('sortBySelect').value;
            
            currentPage = 1;
            loadFaculty(currentPage);
        }
        
        // Load faculty
        async function loadFaculty(page = 1) {
            try {
                showLoading();
                
                const perPage = document.getElementById('perPageSelect').value;
                const params = new URLSearchParams({
                    page: page,
                    per_page: perPage,
                    ...currentFilters
                });
                
                // Remove empty parameters
                for (let [key, value] of [...params.entries()]) {
                    if (!value) {
                        params.delete(key);
                    }
                }
                
                const response = await fetch(`${API_BASE}/faculties?${params}`);
                const data = await response.json();
                
                allFaculty = data.faculties;
                displayFaculty(data.faculties);
                displayPagination(data.pagination);
                updateResultsInfo(data.pagination);
                
            } catch (error) {
                console.error('Error loading faculty:', error);
                showError('Failed to load faculty. Please try again.');
            }
        }
        
        // Display faculty in grid view
        function displayFaculty(faculty) {
            const container = document.getElementById('faculty-grid');
            
            if (faculty.length === 0) {
                container.innerHTML = `
                    <div class="col-12">
                        <div class="text-center p-5">
                            <i class="fas fa-user-slash fa-4x text-muted mb-3"></i>
                            <h4>No faculty found</h4>
                            <p class="text-muted">Try adjusting your search filters or criteria.</p>
                        </div>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = '';
            faculty.forEach(prof => {
                const facultyCard = `
                    <div class="col-lg-6 col-xl-4 mb-4">
                        <div class="faculty-card h-100">
                            <div class="card-body">
                                <div class="faculty-info">
                                    <!-- Professor Name and Title -->
                                    <div class="faculty-header mb-3">
                                        <h5 class="card-title mb-1">
                                            <a href="/faculties?search=${encodeURIComponent(prof.name)}" class="text-decoration-none professor-link">
                                                ${prof.name}
                                            </a>
                                        </h5>
                                        <p class="text-muted small mb-0">
                                            <i class="fas fa-graduation-cap me-1"></i>
                                            ${prof.primary_position || 'Faculty Member'}
                                        </p>
                                    </div>
                                    
                                    <!-- University -->
                                    <div class="faculty-affiliation mb-2">
                                        <p class="text-muted small mb-1">
                                            <i class="fas fa-university me-1"></i>
                                            <a href="/faculties?university=${encodeURIComponent(prof.university_code || prof.university_name)}" 
                                               class="text-decoration-none text-muted hover-primary university-link">
                                                ${prof.university_name || 'Unknown University'}
                                            </a>
                                        </p>
                                        
                                        <!-- Department -->
                                        ${prof.department ? `
                                        <p class="text-muted small mb-0">
                                            <i class="fas fa-building me-1"></i>
                                            <a href="/faculties?department=${encodeURIComponent(prof.department)}" 
                                               class="text-decoration-none text-muted hover-primary department-link" 
                                               title="${prof.department}">
                                                ${prof.department}
                                            </a>
                                        </p>
                                        ` : ''}
                                    </div>
                                    
                                    <!-- Research Areas -->
                                    ${prof.research_areas ? `
                                    <div class="research-areas mt-2 mb-3">
                                        <small class="text-muted">
                                            <i class="fas fa-flask me-1"></i>
                                            ${prof.research_areas.substring(0, 100)}${prof.research_areas.length > 100 ? '...' : ''}
                                        </small>
                                    </div>
                                    ` : ''}
                                    
                                    <!-- Publication Stats -->
                                    <div class="publication-stats mt-3">
                                        <div class="d-flex justify-content-between align-items-center">
                                            <div>
                                                <span class="badge bg-primary me-1">
                                                    <i class="fas fa-file-alt me-1"></i>
                                                    ${prof.total_publications || 0} pubs
                                                </span>
                                                ${prof.publications_last_5_years ? `
                                                <span class="badge bg-success">
                                                    ${prof.publications_last_5_years} recent
                                                </span>
                                                ` : ''}
                                            </div>
                                            <button class="btn btn-outline-primary btn-sm" onclick="viewFacultyProfile('${prof.name}')">
                                                <i class="fas fa-eye me-1"></i>View
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                container.innerHTML += facultyCard;
            });
            
            // Update table view if active
            if (currentView === 'list') {
                displayFacultyTable(faculty);
            }
        }
        
        // Display faculty in table view
        function displayFacultyTable(faculty) {
            const tbody = document.getElementById('faculty-table-body');
            tbody.innerHTML = '';
            
            faculty.forEach(prof => {
                const row = `
                    <tr>
                        <td>
                            <strong>
                                <a href="/faculties?search=${encodeURIComponent(prof.name)}" class="text-decoration-none">
                                    ${prof.name}
                                </a>
                            </strong>
                        </td>
                        <td>${prof.primary_position || 'Faculty Member'}</td>
                        <td>
                            <a href="/faculties?university=${encodeURIComponent(prof.university_code || prof.university_name)}" 
                               class="text-decoration-none">
                                ${prof.university_name || 'Unknown'}
                            </a>
                        </td>
                        <td>${prof.department || 'Not specified'}</td>
                        <td>
                            <small class="text-muted">
                                ${prof.research_areas ? prof.research_areas.substring(0, 50) + (prof.research_areas.length > 50 ? '...' : '') : 'Not specified'}
                            </small>
                        </td>
                        <td class="text-center">
                            <span class="badge bg-primary">${prof.total_publications || 0}</span>
                        </td>
                        <td>
                            <button class="btn btn-outline-primary btn-sm" onclick="viewFacultyProfile('${prof.name}')">
                                <i class="fas fa-eye me-1"></i>View
                            </button>
                        </td>
                    </tr>
                `;
                tbody.innerHTML += row;
            });
        }
        
        // Toggle between grid and list view
        function toggleView(view) {
            currentView = view;
            
            const gridContainer = document.getElementById('faculty-grid');
            const tableContainer = document.getElementById('faculty-table');
            const viewButtons = document.querySelectorAll('[data-view]');
            
            // Update active button
            viewButtons.forEach(btn => {
                btn.classList.remove('active');
                if (btn.getAttribute('data-view') === view) {
                    btn.classList.add('active');
                }
            });
            
            // Toggle views
            if (view === 'grid') {
                gridContainer.style.display = 'flex';
                gridContainer.className = 'row';
                tableContainer.style.display = 'none';
            } else if (view === 'list') {
                gridContainer.style.display = 'none';
                tableContainer.style.display = 'block';
                displayFacultyTable(allFaculty);
            }
        }
        
        // View faculty profile
        function viewFacultyProfile(name) {
            window.location.href = `/faculties?search=${encodeURIComponent(name)}`;
        }
        
        // Clear filters
        function clearFilters() {
            document.getElementById('faculty-search-form').reset();
            currentFilters = {
                search: '',
                country: '',
                university: '',
                department: '',
                research_area: '',
                employment_type: '',
                sort_by: 'name'
            };
            currentPage = 1;
            loadFaculty(currentPage);
        }
        
        // Display pagination
        function displayPagination(pagination) {
            const container = document.getElementById('pagination-container');
            
            if (pagination.total_pages <= 1) {
                container.innerHTML = '';
                return;
            }
            
            let paginationHTML = '<nav aria-label="Faculty pagination"><ul class="pagination">';
            
            // Previous button
            if (pagination.page > 1) {
                paginationHTML += `
                    <li class="page-item">
                        <a class="page-link" href="#" onclick="changePage(${pagination.page - 1})">Previous</a>
                    </li>
                `;
            }
            
            // Page numbers
            const startPage = Math.max(1, pagination.page - 2);
            const endPage = Math.min(pagination.total_pages, pagination.page + 2);
            
            for (let i = startPage; i <= endPage; i++) {
                paginationHTML += `
                    <li class="page-item ${i === pagination.page ? 'active' : ''}">
                        <a class="page-link" href="#" onclick="changePage(${i})">${i}</a>
                    </li>
                `;
            }
            
            // Next button
            if (pagination.page < pagination.total_pages) {
                paginationHTML += `
                    <li class="page-item">
                        <a class="page-link" href="#" onclick="changePage(${pagination.page + 1})">Next</a>
                    </li>
                `;
            }
            
            paginationHTML += '</ul></nav>';
            container.innerHTML = paginationHTML;
        }
        
        // Change page
        function changePage(page) {
            currentPage = page;
            loadFaculty(page);
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
        
        // Update results info
        function updateResultsInfo(pagination) {
            const info = document.getElementById('results-info');
            const start = ((pagination.page - 1) * pagination.per_page) + 1;
            const end = Math.min(pagination.page * pagination.per_page, pagination.total_count);
            
            info.innerHTML = `Faculty Members (${start}-${end} of ${pagination.total_count} found)`;
        }
        
        // Show loading indicator
        function showLoading() {
            const container = document.getElementById('faculty-grid');
            container.innerHTML = `
                <div class="col-12 text-center p-5">
                    <div class="loading-spinner"></div>
                    <p class="mt-3 text-muted">Loading faculty members...</p>
                </div>
            `;
            
            const info = document.getElementById('results-info');
            info.innerHTML = 'Loading faculty members...';
        }
        
        // Show error message
        function showError(message) {
            const container = document.getElementById('faculty-grid');
            container.innerHTML = `
                <div class="col-12">
                    <div class="alert alert-danger">
                        <i class="fas fa-exclamation-triangle me-2"></i>
                        ${message}
                    </div>
                </div>
            `;
            
            const info = document.getElementById('results-info');
            info.innerHTML = 'Error loading data';
        }
    </script>
</body>
</html> 